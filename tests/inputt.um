
import (
	"th.um"
	"rect.um"
	"input.um"
	"canvas.um"
	"window.um"
	"signal.um"
)

y := 200
text := ""
qcount := 0

fn init*() {
	window.setup("input test", 400, 400)

	window.onFrame.register(signal.Callback{
		/*if input.isJustPressed(input.mouse_up) {
			y -= 5
		}
		if input.isJustPressed(input.mouse_down) {
			y += 5
		}*/

		printf("lshift: %s %s %s\n",
			repr(input.isPressed(input.key_left_shift)),
			repr(input.isJustPressed(input.key_left_shift)),
			repr(input.isJustReleased(input.key_left_shift)))

		if input.isJustPressed(input.key_backspace) {
			text = ""
		}

		if input.isJustPressedc('\'') {
			printf("' was just pressed\n")
		}

		if input.isJustPressed(input.key_right) {
			printf("key right was just pressed\n")
		}

		if input.isPressedRepeatc('q') {
			qcount += 1
		}

		if input.isPressedc('S') {
			printf("s is pressed\n")
		}

		if input.isJustReleasedc('T') {
			printf("t was just released\n")
		}

		s := input.getStr()
		if len(s) > 0 {
			printf("input string: %s %s\n", input.getStr(), repr([]char(input.getStr())))
		}

		text = text + s

		canvas.drawText(sprintf("%d", qcount), th.Vf2{5, 40}, th.black, 2);
		canvas.drawText(text, th.Vf2{5, 20}, th.black, 2);
		canvas.drawText(sprintf("%s", repr(input.getMouseScroll())), th.Vf2{5, 5}, th.black, 2);
		canvas.drawRect(th.black, rect.mk(200, y, 5, 5))
	}, text)
}
